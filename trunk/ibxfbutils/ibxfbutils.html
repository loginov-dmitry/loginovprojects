<HTML><HEAD>
<META content="text/html; charset=windows-1251" http-equiv=Content-Type>
<META name=EDITORORG content="HTML Editor">
<META name=GENERATOR content="MSHTML 9.00.8112.16440"></HEAD>
<BODY style="">
<H1>Упрощаем разработку приложений баз данных Firebird</H1>
<P>Версия от 09.05.2012</P>
<H2>Содержание</H2>
<UL>
<LI><A href="#intro">Введение</A></LI>
<LI><A href="#whyfirebird">Почему Firebird?</A></LI>
<LI><A href="#ibx">Компоненты для работы с Firebird</A></LI>
<LI><A href="#ibxlimits">Ограничения&nbsp;стандартных компонентов IBX</A></LI>
<LI><A href="#ibxfbutils">Библиотека функций IBXFBUtils</A></LI>
<LI><A href="#dbstruct">Создание базы данных с нуля и коррекция структуры БД</A></LI>
<LI><A href="#pool">Использование пула подключений к базе данных</A></LI>
<LI><A href="#ini">Хранение конфигурационных параметров в базе данных</A></LI>
<LI><A href="#br">Программный бэкап базы данных</A></LI>
<LI><A href="#eb">Удобный вызов конструкции EXECUTE BLOCK</A></LI>
<LI><A href="#modify">Простой вызов функций для модификации записей в таблице</A></LI>
<LI><A href="#fbbase">Базовые функции библиотеки</A></LI>
<LI><A href="#dll">Особенности использования библиотеки при разработке многомодульного приложения</A></LI>
<LI><A href="#loading">Особенности использования библиотеки при наличии на компьютере нескольких версий Firebird</A></LI>
<LI><A href="#test">Тестирование корректности работы библиотеки IBXFBUtils</A></LI>
<LI><A href="#end">Заключение</A></LI></UL>
<H2 style="">Введение</H2>
<P>Данная статья посвящена вопросам разработки приложений&nbsp;баз данных Firebird в среде Delphi. Автором предлагается решение (библиотека IBXFBUtils), позволяющее существенно упростить разработку таких приложений.</P><A name=whyfirebird></A>
<H2>Почему Firebird?</H2>
<P>Изначально для ответа на этот вопрос автору хотелось обойтись одним абзацем. Но после первого абзаца появился второй, третий, четвертый и т.д. Было принято решение выразить свои мысли в отдельном документе. Так появилась статья <A href="file:///C:/Users/Dima/AppData/Local/Temp/www.loginovprojects.ru/index.php?page=whyfirebird">Почему мне нравится Firebird</A>. Firebird-сообщество в целом поддерживает идеи, выраженные в этой статье.&nbsp;Как вывод:&nbsp;Firebird - оптимальная СУБД для разработки OLTP-решений (а для разработки "коробочных" приложений - идеальное средство).</P><A name=ibx></A>
<H2>Компоненты для работы с Firebird</H2>
<P>Автор&nbsp;привык работать с компонентами&nbsp;IBX. Библиотека InterBase Express является стандартной и доступна сразу же после установки Delphi. Надежность и эффективность IBX проверена годами. Более мощная (но платная) библиотека FIBPlus имеет множество преимуществ по сравнению с IBX, однако из этого не следует делать вывод, что IBX не подходит для серьезных приложений. Очень даже подходит - для сколь угодно сложных приложений.</P>
<P>Во всяком случае и IBX и FIBPlus -&nbsp;очень качественные и надежные решения.<BR>Автор видит лишь два серьезных недостатка библиотеки IBX по отношению&nbsp;к FIBPlus:<BR>- к набору данных нельзя привязать 2 транзакции (для чтения и для записи), что осложняет разработку приложений (эта проблема особенно актуальна для новичков);<BR>- IBX в Delphi XE2 x64 не поддерживает БД Firebird (справедливости ради, разработчики IBX официально никогда Firebird не поддерживали).</P><A name=ibxlimits></A>
<H2>Ограничения&nbsp;стандартных компонентов IBX</H2>
<P>Чаще всего разработчики делают сравнительно простые приложения, состоящие только из одного (основного) потока. При этом размещают на форме (или в TDataModule) все необходимые для работы с БД&nbsp;компоненты (например, TIBDatabase, TIBTransaction, TIBDataSet, TDataSource), настраивают в визуальном режиме необходимые свойства (в том числе SelectSQL, ModifySQL, InsertSQL, DeleteSQL, RefreshSQL для компонентов TIBDataSet) и т.д. Возможностей IBX достаточно для разработки простых приложений, однако, в сложных приложениях разработчику очень часто приходится писать собственные библиотеки функций, упрощающих работу с БД Firebird.</P>
<P>Сами по себе компоненты IBX&nbsp;мало чем помогут:<BR>- при создании базы данных "с нуля" (IBX позволяет создать лишь&nbsp;пустую базу данных; создание таблиц, полей и прочих объектов осуществляется, как правило, в IBExpert);<BR>- при коррекции структуры рабочей базы данных (в этом случае также используют IBExpert);<BR>- при разработке высокопроизводительных многопоточных серверных приложений (в IBX отсутствует пул подключений, что осложняет разработку таких приложений);<BR>- при необходимости хранения в БД&nbsp;разнородной конфигурационной&nbsp;информации (соответствующий механизм в IBX не предусмотрен);<BR>- при резервировании / восстановлении БД (IBX предоставляет необходимые возможности, однако разработчику приходится писать массу собственного кода);<BR>- при необходимости вызова конструкции EXECUTE BLOCK (необходимо помнить весь синтаксис данной конструкции)</P>
<P>Очевидно, что в библиотеке IBX имеется большое количество белых пятен. Решения, предложенные автором, позволяют устранить перечисленные недостатки IBX.</P><A name=ibxfbutils></A>
<H2>Библиотека функций IBXFBUtils</H2>
<P>Использовать данную библиотеку очень просто:<BR>- Для начала ее следует скачать по ССЫЛКЕ и распаковать архив в любом удобном месте. <BR>- Далее следует запустить Delphi, открыть окно настроек&nbsp;<FONT color=#000080>Tools \ Environment Options \ Library \ Library path</FONT> (для Delphi 7) или <FONT color=#000080>Tools \ Options \ Environment Options \ Delphi options \ Library (32-bit Windows) \ Library path</FONT> (для Delphi XE2) и добавить каталог IBXFBUtils. <BR>- Создать новое VCL-приложение и в&nbsp;разделе Uses добавить модули: fbUtils, fbTypes, IBDatabase, IBCustomDataSet, DB.<BR>- Убедиться, что компиляция проекта проходит успешно.<BR><BR>Вся дальнейшая работа осуществляется с помощью глобальной переменной <STRONG><FONT color=#000080>fb</FONT></STRONG>.<BR>В следующем примере осуществляется подключение к базе данных TEST.FDB и добавление записи в таблицу TESTTABLE:</P>
<P>
<table border=1 cellSpacing=0 width="100%" bgColor=#c0dcc0>
<TBODY>
<tr>
<td><FONT face="Courier New"><STRONG>procedure</STRONG> TForm1.Button1Click(Sender: TObject);<BR><STRONG>var</STRONG><BR>&nbsp; fdb: TIBDatabase;<BR><STRONG>begin</STRONG><BR>&nbsp; <FONT color=#000080>// Подключаемся к базе данных + создаем транзакцию RCRW</FONT><BR>&nbsp; fdb := fb.CreateConnection('localhost', FBDefPort, 'C:\TEMP\TEST.FDB',<BR>&nbsp;&nbsp;&nbsp; FBDefUser, FBDefPassword, FBRusCharSet, trRCRW);<BR>&nbsp; <FONT color=#000080>// Добавляем новую запись в таблицу</FONT><BR>&nbsp; fb.InsertRecord(fdb, nil, 'TESTTABLE', ['ID', 'NAME', 'SUMMA'],<BR>&nbsp;&nbsp;&nbsp; [1, 'FIREBIRD - FOREVER', 100500]);<BR>&nbsp; <FONT color=#000080>// Подтверждение транзакции</FONT><BR>&nbsp; fdb.DefaultTransaction.Commit;<BR>&nbsp; <FONT color=#000080>// Удаление подключения к БД</FONT><BR>&nbsp; fb.FreeConnection(fdb);<BR><STRONG>end</STRONG>;</FONT></td></tr></TBODY></table></P>
<P>Если назначение той или иной функции вызывает вопросы,&nbsp;обратитесь к исходным кодам библиотеки IBXFBUtils. <BR><STRONG><U><FONT color=#ff0000>Важно!</FONT></U> Ознакомьтесь с описанием, которое находится в начале модуля fbUtils.pas. Ознакомьтесь с примерами в проекте fbUtilsTest.dpr (модуль TestForm.pas)</STRONG><BR></P><A name=dbstruct></A>
<H2>Создание базы данных с нуля и коррекция структуры БД</H2>
<P>За создание базы данных и коррекцию ее структуры отвечает объект: <STRONG><FONT color=#000080>fb.DBStruct</FONT></STRONG>.<BR>Поддерживаются следующие объекты БД (проверено: FB 2.0, FB2.1, FB2.5):<BR>- таблица;<BR>- поле;<BR>- домен;<BR>- проверка (CHECK);<BR>- первичный ключ;<BR>- внешний ключ;<BR>- индекс;<BR>- генератор;<BR>- исключение (только "ERR");<BR>- хранимая процедура;<BR>- триггер;<BR>- автоинкремент (генератор + триггер).<BR>Многие объекты БД Firebird не поддерживаются, однако важнейшие объекты поддерживаются и для создания коробочных приложений их, как правило, достаточно.<BR>Пример создания базы данных с тестовой таблицей:<BR>
<table border=1 cellSpacing=0 width="100%" bgColor=#c0dcc0>
<TBODY>
<tr>
<td>
<P><FONT face="Courier New"><STRONG>procedure</STRONG> TForm1.Button1Click(Sender: TObject);<BR><STRONG>var</STRONG><BR>&nbsp; ATable: TfbTableDesc;<BR><STRONG>begin</STRONG><BR>&nbsp; <FONT color=#000080>// Пересоздаем объект&nbsp;DefDBDesc (на всякий случай)</FONT><BR>&nbsp; fb.DBStruct.ReCreateDefDataBaseDesc();</FONT></P>
<P><FONT face="Courier New">&nbsp; <FONT color=#000080>// Добавляем описание доменов</FONT><BR>&nbsp;&nbsp;fb.DBStruct.DefDBDesc.AddDomain('T_NUMBER', 'NUMERIC(15,4)', '', CanNull, '');</FONT></P>
<P><FONT face="Courier New">&nbsp; <FONT color=#000080>// Добавляем описание таблицы TESTTABLE </FONT><BR></FONT><FONT face="Courier New">&nbsp; ATable := fb.DBStruct.DefDBDesc.AddTable('TESTTABLE');<BR>&nbsp; <STRONG>with</STRONG> ATable <STRONG>do</STRONG><BR>&nbsp; <STRONG>begin</STRONG><BR>&nbsp;&nbsp;&nbsp; <FONT color=#000080>// Добавляем описание полей</FONT><BR>&nbsp;&nbsp;&nbsp; AddField('ID',&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'INTEGER',&nbsp;&nbsp;&nbsp;&nbsp; '',&nbsp;&nbsp; NotNull);<BR>&nbsp;&nbsp;&nbsp; AddField('RECTYPE',&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'SMALLINT',&nbsp;&nbsp;&nbsp; '',&nbsp;&nbsp; CanNull);<BR>&nbsp;&nbsp;&nbsp; AddField('NAME',&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'VARCHAR(50)', '',&nbsp;&nbsp; CanNull);<BR>&nbsp;&nbsp;&nbsp; AddField('RECDATE',&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'TIMESTAMP',&nbsp;&nbsp; '',&nbsp;&nbsp; CanNull);<BR>&nbsp;&nbsp;&nbsp; AddField('SUMMA',&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'T_NUMBER',&nbsp;&nbsp;&nbsp; '0',&nbsp; CanNull);</FONT></P>
<P><FONT face="Courier New">&nbsp;&nbsp;&nbsp; <FONT color=#000080>// Описание первичного ключа</FONT><BR>&nbsp;&nbsp;&nbsp; SetPrimaryKey('TESTTABLE_PK', '"ID"');</FONT></P>
<P><FONT face="Courier New">&nbsp;&nbsp;&nbsp; <FONT color=#000080>// Описание индекса (по возрастанию)</FONT><BR>&nbsp;&nbsp;&nbsp; AddIndex('TESTTABLE_IDX1', False, Ascending, 'RECDATE');</FONT></P>
<P><FONT face="Courier New">&nbsp;&nbsp;&nbsp; <FONT color=#000080>// Триггер для создания автоинкремента на поле ID</FONT><BR>&nbsp;&nbsp;&nbsp; AddAutoIncTrigger('', 'ID', 'GEN_TESTTABLE_ID', True);</FONT></P>
<P><FONT face="Courier New">&nbsp; <STRONG>end</STRONG>;</FONT></P>
<P><FONT face="Courier New">&nbsp; <FONT color=#000080>// Создание базы данных</FONT>&nbsp; <BR>&nbsp; fb.DBStruct.CheckDefDataBaseStruct('localhost', FBDefPort, 'C:\TEMP\TEST.FDB',<BR>&nbsp;&nbsp;&nbsp; FBDefUser, FBDefPassword, FBRusCharSet, nil);</FONT></P>
<P><FONT face="Courier New"><STRONG>end</STRONG>;</FONT><BR></P></td></tr></TBODY></table></P>
<P><STRONG><FONT color=#ff0000>Внимание!</FONT></STRONG> Если Вы решите&nbsp;скопировать данный пример "один-в-один", то перед его запуском&nbsp;убедитесь в существовании каталога "C:\TEMP\". Автоматическое создание каталогов не выполняется.</P>
<P>Таким образом, описание структуры БД может располагаться непосредственно в исходных кодах. Это весьма удобно, поскольку гарантируется наличие всех необходимых&nbsp;объектов в базе данных. В любой момент Вы можете добавить новый объект к своему описанию и он гарантированно появится в БД.</P>
<P>Если Вам потребуется добавить новый объект в БД, которая уже давно используется и содержит множество таблиц, то Вам достаточно добавить описание лишь для этого объекта и он будет автоматически создан в БД.</P>
<P>Если Вы изменяете исходные коды триггеров или хранимых процедур, то необходимая коррекция БД будет выполнена автоматически.<BR>Допускается коррекция длины полей&nbsp;типа VARCHAR, но только в большую сторону.<BR><STRONG>Внимание!</STRONG> При исправлении описания объектов "Поле", "Первичный ключ", "Внешний ключ", "Индекс", "Домен", "Проверка" коррекция БД <STRONG>не производится.</STRONG> <BR>Необходимо заранее и тщательно продумывать описание каждого объекта БД.<BR>Удаление объектов из БД <STRONG>не предусмотрено.</STRONG><BR><BR>Ниже представлены замечания по выбору типов полей и их наименований:<BR>
<table border=1 cellSpacing=0 width="100%" bgColor=#c0dcc0>
<TBODY>
<tr>
<td>
<P>- Для хранения денежных величин, а также любых вещественных чисел с заданным количеством знаков после запятой, используйте тип DECIMAL (или NUMERIC). Данный тип не допускает потери точности.<BR>- Для хранения вещественных чисел с неизвестным количеством знаков после запятой (например, цена закупки, которая вычисляется как сумма закупки, деленная на количество купленных изделий), используйте тип DOUBLE PRECISION. <BR><STRONG>- Внимание!</STRONG> Никогда не используйте тип FLOAT, т.к. точность хранения вещественных чисел очень низкая.<BR>- Не экономьте на длине строкового поля. Лучше для хранения фамилии сразу выбрать тип поля VARCHAR(100), чем создать короткое поле VARCHAR(20), а затем ломать голову над тем, как его расширить. Тем более, эта цифра не влияет на объем пространства, используемого в файле базы данных - учитываются только реальные символы.<BR>- Для хранения логических значений используйте тип поля INTEGER. Он занимает не больше чем CHAR или VARCHAR, при этом целые числа (1, 0) проще использовать в SQL-запросах, а также в коде программы.<BR>- Наименования полей должны содержать ТОЛЬКО латинские символы и цифры (аналогично идентификаторам в Pascal). Попытки использовать кириллицу, пробелы, апострофы и др. символы зачастую влекут за собой множество проблем.<BR>- Длина имени&nbsp;объектов БД (таблиц, полей и т.п.)&nbsp;должна быть минимальной&nbsp;(но так, чтобы можно было потом&nbsp;разобраться). Firebird накладывает ограничение на длину имени (31 символ), однако часто требуются различные префиксы и суффиксы (например, для таблицы TEST имя первичного ключа может быть: TEST_PRIMARY, имя генератора: GENERATOR_TEST_ID и т.п.), поэтому 31 символ - это совсем не большое число. Рекомендуется префиксы и суффиксы делать как можно короче (TEST_PK вместо TEST_PRIMARY, GEN_TEST вместо GENERATOR_TEST_ID, TEST_IDX1 вместо INDEX_TEST_NAMEOFFIELD и т.п.). Это позволит Вам&nbsp;строго придерживаться&nbsp;принятых Вами&nbsp;правил именования для любых объектов.<BR>- Разумеется, ести таблица называется CATEGORY, то абсолютным абсурдом является дублирование имени таблицы в наименованиях полей: CATEGORY_ID, CATEGORY_NAME. Гораздо лучше сократить: CAT_ID, CAT_NAME и т.д. Но, зачастую, лишние префиксы не используют, т.е. достаточно: ID, NAME <FONT color=#808080>(автор многократно убеждался в преимуществах именно этого подхода, особенно при активном использовании языка SQL)</FONT>. Следует учитывать в первую очередь те правила именования, которые уже действуют в Вашей организации.<BR></P></td></tr></TBODY></table></P><A name=pool></A>
<H2>Использование пула подключений к базе данных</H2>
<P>Весьма часто у программистов возникает необходимость в разработке приложений с интенсивным выполнением операций подключения и отключения&nbsp;БД. <BR>Примеры:<BR>-&nbsp;WEB-приложение, обслуживающее большое количество одновременных HTTP-запросов (для каждого запроса требуется подключиться к БД, сохранить необходимую информацию и отключиться от БД).<BR>- TCP-сервер, обслуживающий большое количество одновременных подключений.<BR>- DCOM-сервера, службы и т.п.<BR>Подключение к БД - это весьма ресурсоёмкая операция, длительность которой может достигать несколько секунд. Пул подключений позволяет снизить остроту проблемы, поскольку в этом случае команда&nbsp;"отключение от БД" не приводит к физическому отключению от БД (вместо этого подключение сохраняется в пуле и остается активным). Большинство современных компонентов подключения к БД содержат встроенный пул подключений, однако в IBX его нет.</P>
<P>Библиотека IBXFBUtils предоставляет удобные средства для работы с пулом подключений, при этом используется объект <STRONG><FONT color=#000080>fb.Pool</FONT></STRONG>.<BR>Работа с пулом подключений выглядит следующим образом:<BR></P>
<P>
<table border=1 cellSpacing=0 width="100%" bgColor=#c0dcc0>
<TBODY>
<tr>
<td><FONT face="Courier New"><STRONG>procedure</STRONG> TForm1.Button1Click(Sender: TObject);<BR><STRONG>var</STRONG><BR>&nbsp; fdb: TIBDatabase;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT color=#000080>// Объект-подключение</FONT><BR>&nbsp; ftran: TIBTransaction; <FONT color=#000080>// Транзакция (для записи)</FONT><BR><STRONG>begin</STRONG><BR>&nbsp; <FONT color=#000080>// Получаем подключение из пула (транзакция будет создана автоматически)</FONT><BR>&nbsp; fdb := fb.Pool.GetConnection('localhost', FBDefPort, 'C:\TEMP\TEST.FDB',<BR>&nbsp;&nbsp;&nbsp; FBDefUser, FBDefPassword, FBRusCharSet, nil, @ftran);<BR>&nbsp; <STRONG>try</STRONG><BR>&nbsp;&nbsp;&nbsp; <FONT color=#000080>// Добавляем новую запись</FONT><BR>&nbsp;&nbsp;&nbsp; fb.InsertRecord(fdb, ftran, 'TESTTABLE', ['ID', 'NAME', 'SUMMA'],<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [2, 'FIREBIRD - FOREVER', 100500]);<BR>&nbsp;&nbsp;&nbsp; <FONT color=#000080>// Подтверждаем транзакцию</FONT><BR>&nbsp;&nbsp;&nbsp; ftran.Commit;<BR>&nbsp; <STRONG>finally</STRONG><BR>&nbsp;&nbsp;&nbsp; <FONT color=#000080>// Возвращаем подключение обратно в пул<BR>&nbsp;&nbsp;&nbsp; // Объект-транзакция будет уничтожен автоматически</FONT><BR>&nbsp;&nbsp;&nbsp; fb.Pool.ReturnConnection(fdb);<BR>&nbsp; <STRONG>end</STRONG>;<BR><STRONG>end</STRONG>;</FONT></td></tr></TBODY></table></P>
<P>Не рекомендуется длительное время использовать подключение, полученное из пула. После получения&nbsp;подключения из пула и выполнения серии операций с БД, следует незамедлительно вернуть подключение обратно в пул. Благодаря этому количество активных подключений в пуле будет всегда минимальным.</P>
<P>Следует отметить, что на Delphi-форумах весьма часто появляются вопросы по одновременной&nbsp;работе с БД Firebird из параллельных потоков. Ответов (и советов)&nbsp;на подобные вопросы много и они самые разные:<BR>- осуществлять всю работу&nbsp;с БД в каком-то одном потоке (остальные потоки дают команду и ожидают, когда этот поток закончит обработку команды). Данный подход на практике весьма сложен, требует от программиста глубоких знаний по вопросам обеспечения синхронизации между потоками, делает работу с БД крайне низкоэффективной.<BR>- для каждого потока создавать собственное подключение к БД&nbsp;и все необходимые объекты. Это -&nbsp;основной подход, однако при работе с БД из большого числа параллельных потоков, а также при интенсивных коннектах / дисконнектах, снижается&nbsp;общая производительность системы.<BR>- множество других&nbsp;ответов и "советов".</P>
<P>Использование пула подключений упрощает разработку сложных (в том числе многопоточных) приложений и улучшает производительность системы в целом.</P>
<P>Обратите внимание на метод <FONT color=#000080>fb.Pool.AddDefaultConnectionProfile()</FONT>. Он позволяет однократно задать настройки подключения к БД по умолчинию. В дальнейшем для&nbsp;извлечения подключения из пула&nbsp;можно вызвать метод <FONT color=#000080>fb.Pool.GetDefaultConnection()</FONT> с минимальным количеством параметров.</P><A name=ini></A>
<H2>Хранение конфигурационных параметров в базе данных</H2>
<P>Хранение структурированной&nbsp;информации в БД - это обычная задача. Несмотря на это, многие разработчики используют INI-файлы для хранения конфигурационных параметров своих приложений. Работа с INI-файлами весьма проста и удобна, однако имеется ряд недостатков:<BR>- невозможно хранить глобальные параметры, которые должны использоваться всеми приложениями, подключенными к БД с разных компьютеров;<BR>- невозможно хранить большие объекты (двоичные, текстовые, графические);<BR>- расширение INI в ОС Windows является опасным, поскольку ОС в случае сбоя может откатить собственное состояние на предыдущую точку восстановления, при этом возвращаются старые версии всех INI-файлов (для избежание подобной проблемы часто используют расширение "<FONT color=#000080>*.conf</FONT>");<BR>- при работе с TIniFile на формат хранения чисел, а также даты/времени, влияют региональные настройки, заданные в ОС (если перед чтением из INI-файла изменились региональные настройки, то программа не сможет считать значение, записанное в файл перед этим);<BR>- сложность хранения многострочного текста, а также строк, содержащих "недопустимые" символы;<BR>- зависимость скорости чтения/записи параметров от размера INI-файла (хотя вряд ли это актуально);<BR>- многие антивирусы при каждом изменении INI-файла перепроверяют его целиком, что в некоторых случаях резко ухудшает производительность системы;<BR>- пользователь может открыть INI-файл в обычном блокноте и испортить его содержимое;<BR>- в рамках одного INI-файла сложно разделить настройки для разных пользователей;<BR>- одновременное обращение к одному INI-файлу из нескольких приложений может привести к его порче (не все ОС предусматривают подобный режим работы с INI-файлами).<BR><FONT color=#808080>(После всего прочитанного не следует пугаться INI-файлов. Это прекрасный механизм, который еще всех нас переживет. Существует разработанный автором модуль <A href="http://www.loginovprojects.ru/index.php?page=downloads&amp;categ=other#safeinifiles">SafeIniFiles</A>, устраняющий многие недостатки INI-файлов)</FONT></P>
<P>Автором предлагается решение, позволяющее хранить в БД все конфигурационные настройки, при этом процесс написания кода ничем не отличается от работы с объектом TIniFile. Работа с INI-файлами осуществляется с помощью объекта <STRONG><FONT color=#000080>fb.Ini</FONT></STRONG>.<BR>
<table border=1 cellSpacing=0 width="100%" bgColor=#c0dcc0>
<TBODY>
<tr>
<td><FONT face="Courier New"><STRONG>procedure</STRONG> TForm1.Button1Click(Sender: TObject);<BR><STRONG>var</STRONG><BR>&nbsp; Ini: TFBIniFile;<BR>&nbsp; Value: Integer;<BR><STRONG>begin</STRONG><BR>&nbsp; <FONT color=#000080>// Создаем объект INI-файл</FONT><BR>&nbsp; Ini := fb.Ini.CreateIni('localhost', FBDefPort, 'C:\TEMP\TEST.FDB',<BR>&nbsp;&nbsp;&nbsp; FBDefUser, FBDefPassword, FBRusCharSet);<BR>&nbsp; <STRONG>try</STRONG><BR>&nbsp;&nbsp;&nbsp; <FONT color=#000080>// Записываем строку в INI-файл</FONT><BR>&nbsp;&nbsp;&nbsp; Ini.WriteString('Params', 'MyString', 'Hello, World!');<BR>&nbsp;&nbsp;&nbsp; <FONT color=#000080>// Читаем целочисленное значение из INI-файла</FONT><BR>&nbsp;&nbsp;&nbsp; Value := Ini.ReadInteger('Params', 'MyValue', 0);<BR>&nbsp;&nbsp;&nbsp; // Запись даты/времени в INI-файл (упрощенный вариант)<BR>&nbsp;&nbsp;&nbsp;&nbsp; <BR>&nbsp; <STRONG>finally</STRONG><BR>&nbsp;&nbsp;&nbsp; <FONT color=#000080>// Уничтожаем объект INI-файл</FONT><BR>&nbsp;&nbsp;&nbsp; fb.Ini.FreeIni(Ini);<BR>&nbsp; <STRONG>end</STRONG>;<BR><STRONG>end</STRONG>;</FONT></td></tr></TBODY></table></P>
<P>Предлагаемое решение охватывает все возможности стандартного TIniFile и <STRONG><U>добавляет множество усовершенствований</U></STRONG>. При этом могут учитываться:<BR>- наименование INI-файла;<BR>- имя пользователя;<BR>- имя компьютера.<BR><STRONG><FONT color=#ff0000>Внимание!</FONT></STRONG> <STRONG>Большое количество примеров по работе с INI-файлами&nbsp;Вы найдете в приложении FBUtilsTest</STRONG>. Там же приведена структура таблицы "CONFIGPARAMS" и код ее автоматического создания.<BR>Следует отметить, что решение не рассчитано&nbsp;на хранение слишком большого количества настроек, поскольку запись / чтение каждой настройки занимает ненулевое время (несколько миллисекунд).</P><A name=br></A>
<H2>Программный бэкап базы данных</H2>
<P>Необходимо регулярно делать резервную копию (бэкап) базы данных. Стандартная библиотека IBX предоставляет функции (service-api), необходимые для выполнения бэпака, однако во многих случаях разработчики приложений ими пренебрегают. Предлагаемая библиотека содержит несколько простых&nbsp;функций для выполнения резервирования / восстановления БД с помощью service-api.<BR>Для резервирования / восстановления БД предназначен объект <STRONG><FONT color=#000080>fb.br</FONT></STRONG>.<BR>Ниже представлен пример создания резервной копии БД:<BR>
<table border=1 cellSpacing=0 width="100%" bgColor=#c0dcc0>
<TBODY>
<tr>
<td><FONT face="Courier New">fb.br.BackupDatabaseOnServer('localhost', FBDefPort, 'C:\TEMP\TEST.FDB', 'C:\TEMP\mytestdbbackup.fbk',&nbsp;<BR>&nbsp; FBDefUser, FBDefPassword, FBDefBackupOptions, BackupRestoreProgressProc);</FONT></td></tr></TBODY></table></P>
<P>Пример восстановления из резервной копии:<BR>
<table border=1 cellSpacing=0 width="100%" bgColor=#c0dcc0>
<TBODY>
<tr>
<td><FONT face="Courier New">fb.br.RestoreDatabaseOnServer('localhost', FBDefPort, 'C:\TEMP\TEST_COPY.FDB',&nbsp;'C:\TEMP\mytestdbbackup.fbk',<BR>&nbsp; FBDefUser, FBDefPassword, FBDefRestoreOptions + [Replace], BackupRestoreProgressProc);</FONT></td></tr></TBODY></table></P>
<P><FONT face="Courier New"><FONT color=#000080>BackupRestoreProgressProc</FONT> </FONT>- это функция обратного вызова, в которую передается информация о ходе выполнения операций. Предусмотрена возможность прерывания операции резервирования / восстановления в любой момент.</P>
<P>Часто&nbsp;требуется возможность загрузки созданного&nbsp;файла резервной копии с сервера на клиент. Для этого предусмотрена функция <FONT color=#000080 face="Courier New">fb.br.BackupDatabaseAndCopyFromServer</FONT>.<BR>При необходимости можно загрузить файл резервной копии с клиента на сервер и выполнить восстановление БД. Для этого предусмотрена функция&nbsp;<FONT color=#000080 face="Courier New">fb.br.CopyBackupToServerAndRestoreDatabase</FONT>.</P>
<P><STRONG>Примеры смотрите в приложении FBUtilsTest.</STRONG></P><A name=eb></A>
<H2>Удобный вызов конструкции EXECUTE BLOCK</H2>
<P>Наличие в Firebird'e конструкции EXECUTE BLOCK избавляет от необходимости создавать в БД хранимые процедуры по любому поводу. Фактически EXECUTE BLOCK - это та же самая хранимая процедура, однако она не имеет имени и не хранится в базе данных. Как и хранимые процедуры, EXECUTE BLOCK может возвращать результат (набор данных), а может и не возвращать.<BR>Пример вызова EXECUTE BLOCK, возвращающего набор данных:<BR>
<table border=1 cellSpacing=0 width="100%" bgColor=#c0dcc0>
<TBODY>
<tr>
<td><FONT face="Courier New"><STRONG>var</STRONG> <BR>&nbsp; ds: TIBDataSet;<BR><STRONG>begin</STRONG>&nbsp; <BR>&nbsp; ds := fb.ExecuteBlock(fdb, ftran,<BR>&nbsp;&nbsp;&nbsp; 'CNT INTEGER, AvgSum DOUBLE PRECISION',&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT color=#000080>// Поля результирующего набора данных</FONT><BR>&nbsp;&nbsp;&nbsp; '',&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<FONT color=#000080>// Локальные переменные - отсутствуют</FONT><BR>&nbsp;&nbsp;&nbsp; <STRONG>'SELECT</STRONG> COUNT(ID), AVG(SUMMA) <STRONG>FROM</STRONG> TESTTABLE '+ <FONT color=#000080>// Выполняем агригирующий запрос</FONT><BR>&nbsp;&nbsp;&nbsp; <STRONG>'INTO</STRONG> :CNT, :AvgSum; '+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT color=#000080>// Сохраняем результат запроса в переменные</FONT><BR>&nbsp;&nbsp;&nbsp; <STRONG>'SUSPEND</STRONG>;');&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT color=#000080>// Отправляем запись клиентскому&nbsp;приложению</FONT><BR>&nbsp;&nbsp;<FONT color=#000080>// *** ОПЕРАТОРЫ ДЛЯ ОБРАБОТКИ ПОЛУЧЕННОГО НАБОРА ДАННЫХ *** //</FONT><BR>&nbsp; ds.Free;<BR><STRONG>end</STRONG>;</FONT></td></tr></TBODY></table></P>
<P>Пример вызова EXECUTE BLOCK,&nbsp;не&nbsp;возвращающего набор данных:<BR>
<table border=1 cellSpacing=0 width="100%" bgColor=#c0dcc0>
<TBODY>
<tr>
<td><FONT face="Courier New">&nbsp; fb.ExecuteBlock(fdb, ftran,<BR>&nbsp;&nbsp;&nbsp; 'vID INTEGER, vName VARCHAR(100)',&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT color=#000080>// Объявляем локальные&nbsp;переменные</FONT><BR>&nbsp;&nbsp;&nbsp; ' <STRONG>FOR</STRONG> <STRONG>SELECT</STRONG> ID, NAME <STRONG>FROM</STRONG> TESTTABLE '+&nbsp;&nbsp; <FONT color=#000080>// Для каждой строки запроса</FONT><BR>&nbsp;&nbsp;&nbsp; '&nbsp;&nbsp;&nbsp;&nbsp; <STRONG>WHERE</STRONG> NAME <STRONG>IS</STRONG> <STRONG>NULL</STRONG> <STRONG>ORDER</STRONG> <STRONG>BY</STRONG> 1 '+&nbsp;&nbsp;&nbsp; <FONT color=#000080>// с заданным условием и сортировкой</FONT><BR>&nbsp;&nbsp;&nbsp; ' <STRONG>INTO</STRONG> :vID, :vName '+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT color=#000080>// Сохраняем ID и NAME в переменные</FONT><BR>&nbsp;&nbsp;&nbsp; ' <STRONG>DO</STRONG> '+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT color=#000080>// выполнить...</FONT><BR>&nbsp;&nbsp;&nbsp; ' <STRONG>BEGIN</STRONG> '+<BR>&nbsp;&nbsp;&nbsp; '&nbsp;&nbsp; <STRONG>UPDATE</STRONG> TESTTABLE <STRONG>SET</STRONG> SUMMA=SUMMA+1, NAME=:vName <STRONG>WHERE</STRONG> ID=:vID; '+ <FONT color=#000080>// Обновление строки таблицы</FONT><BR>&nbsp;&nbsp;&nbsp; ' <STRONG>END</STRONG> ');</FONT></td></tr></TBODY></table></P>
<P><STRONG>Примеры смотрите в приложении FBUtilsTest.</STRONG></P><A name=modify></A>
<H2>Простой вызов функций для модификации записей в таблице</H2>
<P>Пример добавления записи:<BR>
<table border=1 cellSpacing=0 width="100%" bgColor=#c0dcc0>
<TBODY>
<tr>
<td><FONT face="Courier New">&nbsp; fb.InsertRecord(fdb, ftran,<BR>&nbsp;&nbsp;&nbsp; 'TESTTABLE',&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<FONT color=#000080>// Имя таблицы</FONT><BR>&nbsp;&nbsp;&nbsp; ['ID', 'NAME', 'RECDATE'],&nbsp;&nbsp;<FONT color=#000080>// Имена полей таблицы</FONT><BR>&nbsp;&nbsp;&nbsp; [1, 'Наименование', Now]);&nbsp;&nbsp;<FONT color=#000080>// Значения полей (целое, строка, дата/время)</FONT></FONT><FONT face="Courier New"></FONT></td></tr></TBODY></table></P>
<P>Пример изменения записи:<BR>
<table border=1 cellSpacing=0 width="100%" bgColor=#c0dcc0>
<TBODY>
<tr>
<td><FONT face="Courier New">&nbsp; fb.UpdateRecord(fdb, ftran,<BR>&nbsp;&nbsp;&nbsp; 'TESTTABLE',&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<FONT color=#000080>// Имя таблицы</FONT><BR>&nbsp;&nbsp;&nbsp; ['ID'],&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT color=#000080>// Ключевые поля</FONT><BR>&nbsp;&nbsp;&nbsp; [1],&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;<FONT color=#000080>// Значения ключевых полей</FONT><BR>&nbsp;&nbsp;&nbsp; ['SUMMA', 'RECTYPE'],&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<FONT color=#000080>// Имена полей таблицы</FONT><BR>&nbsp;&nbsp;&nbsp; [1000000, 5]);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<FONT color=#000080>// Значения полей</FONT></FONT><FONT face="Courier New"></FONT></td></tr></TBODY></table></P>
<P>Пример удаления записи:<BR>
<table border=1 cellSpacing=0 width="100%" bgColor=#c0dcc0>
<TBODY>
<tr>
<td><FONT face="Courier New">&nbsp; fb.DeleteRecord(fdb, ftran,<BR>&nbsp;&nbsp;&nbsp; 'TESTTABLE',&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<FONT color=#000080>// Имя таблицы</FONT><BR>&nbsp;&nbsp;&nbsp; ['ID'],&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<FONT color=#000080>// Ключевые поля</FONT><BR>&nbsp;&nbsp;&nbsp; [1]);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<FONT color=#000080>// Значения ключевых полей</FONT></FONT></td></tr></TBODY></table></P>
<P>Пример изменения / добавления записи:<BR>
<table border=1 cellSpacing=0 width="100%" bgColor=#c0dcc0>
<TBODY>
<tr>
<td><FONT face="Courier New">&nbsp; fb.UpdateOrInsertRecord(fdb, ftran,<BR>&nbsp;&nbsp;&nbsp; 'TESTTABLE',&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT color=#000080>// Имя таблицы</FONT><BR>&nbsp;&nbsp;&nbsp; ['ID', 'NAME', 'RECDATE', 'SUMMA'],&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT color=#000080>// Имена полей таблицы</FONT><BR>&nbsp;&nbsp;&nbsp; [1, 'Наименование', Now, Random(100000)], <FONT color=#000080>// Значения полей</FONT><BR>&nbsp;&nbsp;&nbsp; ['ID']);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT color=#000080>// Ключевое поле (для поиска совпадения)</FONT></FONT></td></tr></TBODY></table></P>
<P>При визуальном программировании подобные функции, как правило, не требуются, но в&nbsp;некоторых других случаях они весьма полезны.</P><A name=fbbase></A>
<H2>Базовые функции библиотеки</H2>
<P>Обращение к базовым функциям осуществляется через объект <STRONG><FONT color=#000080>fb</FONT></STRONG>. Подробное описание и реализацию&nbsp;функций смотрите в модуле <FONT color=#000080>fbUtilsBase</FONT>.</P>
<P>
<table border=1 cellSpacing=0 width="100%">
<TBODY>
<tr style="FONT-WEIGHT: bold" align=center>
<td width="30%">Функция</td>
<td>Описание</td></tr>
<tr>
<td><FONT color=#000080><STRONG>function</STRONG> CreateConnection</FONT></td>
<td>Создает подключение к базе данных. Возвращает объект TIBDataBase. При необходимости создает объект-транзакцию (заданного типа). По умолчанию устанавливает подключение к БД.<BR><FONT color=#ff0000><STRONG>Внимание!</STRONG></FONT> Не следует использовать функции <FONT color=#000080>CreateConnection</FONT>, <FONT color=#000080>ConnectDB</FONT>, <FONT color=#000080>CreateTransaction</FONT>, <FONT color=#000080>DisconnectDB</FONT>, <FONT color=#000080>FreeConnection</FONT>, если Вы работаете с пулом подключений <FONT color=#000080>fb.Pool</FONT> (в этом нет необходимости).</td></tr>
<tr>
<td><FONT color=#000080><STRONG>procedure</STRONG> ConnectDB</FONT></td>
<td>Устанавливает подключение к БД (можно безопасно вызывать из параллельных потоков).</td></tr>
<tr>
<td><FONT color=#000080><STRONG>procedure</STRONG> DisconnectDB</FONT></td>
<td>Закрывает подключение к БД.</td></tr>
<tr>
<td><FONT color=#000080><STRONG>procedure</STRONG> FreeConnection</FONT></td>
<td>Уничтожение объекта подключения к БД.</td></tr>
<tr>
<td><FONT color=#000080><STRONG>function</STRONG>&nbsp;CreateTransaction</FONT></td>
<td>Создание объекта&nbsp;транзакции TIBTransaction&nbsp;указанного типа. По умолчанию используется транзакция RCRW и осуществляется автоматический старт транзакции.</td></tr>
<tr>
<td><FONT color=#000080><STRONG>function</STRONG> CreateDataSet</FONT></td>
<td>Создание набора данных TIBDataSet. <U>Не обязательно указывать оба параметра (TIBDataBase и TIBTransaction). Если указать только один из них (а другой - <STRONG><FONT color=#000080>nil</FONT></STRONG>), то второй объект будет определен автоматически</U>. Не желательно в качестве AOwner указывать TIBDataBase&nbsp;/ TIBTransaction, т.к. в некоторых версиях Delphi присутствует глюк в IBX, который не позволяет этого сделать.</td></tr>
<tr>
<td><FONT color=#000080><STRONG>function</STRONG> CreateAndOpenDataSet</FONT></td>
<td>Создает и открывает набор данных TIBDataSet. <FONT color=#000080>SQL</FONT> - текст SQL-запроса; <FONT color=#000080>ParamNames </FONT>- открытый массив наименований параметров; <FONT color=#000080>ParamValues </FONT>- открытый массив&nbsp;значений параметров.<BR>Если параметры не требуются, то должен быть указан пустой массив: <FONT color=#000080><STRONG>[]</STRONG></FONT><BR>Функция автоматически загружает на клиента все записи из набора данных (команда FetchAll).</td></tr>
<tr>
<td><FONT color=#000080><STRONG>function</STRONG> CreateAndOpenTable</FONT></td>
<td>Создает объект TIBDataSet и открывает таблицу. <FONT color=#000080>ATable </FONT>- имя таблицы, <FONT color=#000080>AFilter </FONT>- условие фильтрации, <FONT color=#000080>AOrder </FONT>- поля сортировки. Автоматически выполняет команду FetchAll.</td></tr>
<tr>
<td><FONT color=#000080><STRONG>procedure</STRONG> ExecQuery</FONT></td>
<td>Выполняет заданный&nbsp;SQL-запрос (DML или DDL).</td></tr>
<tr>
<td><FONT color=#000080><STRONG>procedure</STRONG> UpdateRecord, InsertRecord, DeleteRecord, UpdateOrInsertRecord</FONT></td>
<td>Функции для модификации записей в таблице (примеры см. выше). Следует отметить, что <FONT color=#000080>KeyFields</FONT>, <FONT color=#000080>KeyValues</FONT>, <FONT color=#000080>FieldNames</FONT>, <FONT color=#000080>AFieldValues </FONT>- это открытые массивы, поэтому список значений должен располагаться в квадратных скобках.</td></tr>
<tr>
<td><FONT color=#000080><STRONG>procedure</STRONG> RecomputeIndexStatistics</FONT></td>
<td>Осуществляет пересчет индексной статистики.</td></tr>
<tr>
<td><FONT color=#000080><STRONG>function</STRONG> GenID</FONT></td>
<td>Получает очередное значение генератора.</td></tr>
<tr>
<td><FONT color=#000080><STRONG>function</STRONG> / <STRONG>procedure</STRONG>&nbsp;&nbsp;ExecuteBlock</FONT></td>
<td>Выполняет команду EXECUTE BLOCK (см. выше)</td></tr>
<tr>
<td><FONT color=#000080><STRONG>procedure</STRONG> ClearTable</FONT></td>
<td>Выполняет очистку указанной таблицы <FONT color=#000080>ATableName</FONT>. <FONT color=#000080>AWhere</FONT> - условие поиска записей для удаления. <FONT color=#000080>GarbageCollection</FONT> - определяет, требуется ли сборка мусора. При сборке мусора не следует указывать транзакцию (указать <STRONG><FONT color=#000080>nil</FONT></STRONG>).</td></tr>
<tr>
<td><FONT color=#000080><STRONG>property</STRONG> DBStruct</FONT></td>
<td>Функции&nbsp;для создания БД с нуля и коррекции ее структуры.</td></tr>
<tr>
<td><FONT color=#000080><STRONG>property</STRONG> Pool</FONT></td>
<td>Функции для работы с пулом подключений.</td></tr>
<tr>
<td><FONT color=#000080><STRONG>property</STRONG> Ini</FONT></td>
<td>Функции для работы с INI-файлами (в базе данных).</td></tr>
<tr>
<td><FONT color=#000080><STRONG>property</STRONG> br</FONT></td>
<td>Функции для бэкапа / рестора базы данных.</td></tr>
<tr>
<td><FONT color=#000080><STRONG>property</STRONG> UserName</FONT></td>
<td>Запись / чтение глобальной переменной FBUserName</td></tr>
<tr>
<td><FONT color=#000080><STRONG>property</STRONG> Password</FONT></td>
<td>Запись / чтение глобальной переменной FBPassword</td></tr></TBODY></table></P><A name=dll></A>
<H2>Особенности использования библиотеки при разработке многомодульного приложения</H2>
<P>Сложный программный проект может состоять из множества исполняемых модулей (EXE и DLL-файлов). В этом случае рекомендуется весь основной исполняемый код библиотеки IBXFBUtils&nbsp;разместить в отдельной библиотеке&nbsp;fbUtils.dll. Для этого необходимо открыть в Delphi проект fbUtils.dpr и в опциях проекта<BR>- указать директиву условной компиляции FBUTILSDLL;<BR>- установить флаг "Build (Link) with runtime packages" и добавить в список пакет "ibxpress".<BR>То же самое следует сделать для всех EXE и DLL, входящих в Ваш программный проект.<BR>Следует учитывать, что в поставку Вашего приложения войдут файлы: fbUtils.dll,&nbsp;rtlNN.bpl, dbrtlNN.bpl, ibxpressNN.bpl (номер NN&nbsp;зависит от версии Delphi).</P>
<P>Разумеется, никто не мешает скомпилировать всю библиотеку IBXFBUtils в виде отдельного run-time-пакета (автор не видит необходимости предоставлять для этого случая отдельную инструкцию).</P><A name=loading></A>
<H2>Особенности использования библиотеки при наличии на компьютере нескольких версий Firebird</H2>
<P>Очевидно, что для подключения к БД Firebird&nbsp;Вы должны указывать TCP-порт на котором работает экземпляр Firebird, требуемый вашему приложению. Этот порт (по умолчанию: 3050) настраивается в файле "firefird.conf", который расположен в каталоге с установленным Firebird. В этом же каталоге расположен файл "firebird.msg", в котором хранится текст сообщений об ошибках, а также "firebird.log", хранящий логи работы Firebird. Там же расположен файл "fbclient.dll". Необходимо создать копию этого файла в том же каталоге и переименовать его в "GDS32.dll". Указанные файлы (особенно "firebird.msg" и "GDS32.dll") очень важны для правильного функционирования клиентского приложения. При необходимости Вы можете явно указать место расположения этих файлов. Для этого достаточно подключить к своему проекту модуль "fbUtilsLoading.pas" (при наличии библиотеки&nbsp;fbUtils.dll - достаточно только к ней) и указать правильное значение для констант <FONT color=#000080>FirebirdPath</FONT> и <FONT color=#000080>GDS32FileName</FONT>. Там же Вы можете определить реакцию приложения на возможные ошибки загрузки GDS32.dll.&nbsp;Рекомендуется ознакомиться с описанием, которое приведено в начале модуля "fbUtilsLoading.pas".</P><A name=test></A>
<H2>Тестирование корректности работы библиотеки IBXFBUtils</H2>
<P>Рекомендуется перед началом использования&nbsp;произвести проверку корректности библиотеки IBXFBUtils. Для этого откройте в Delphi проект "fbUtilsTest.dpr" и выполните его компиляцию. Если возникла ошибка, устраните ее причины. После успешной сборки запустите приложение, укажите параметры подключения к тестовой (несуществующей) базе данных и поочередно запустите тесты (начните с пункта "Коррекция структуры БД").</P><A name=end></A>
<H2>Заключение</H2>
<P>Несмотря на то, что реализация&nbsp;IBXFBUtils заняла у автора около месяца, на самом деле в этой библиотеке сосредоточен труд нескольких лет. Были позаимствованы лучшие идеи по работе в Firebird&nbsp;из&nbsp;предыдущих проектов. Библиотека позволяет значительно ускорить разработку приложений баз данных.&nbsp;Конструктивную критику,&nbsp;замечания и предложения по улучшению библиотеки&nbsp;отправляйте на электронную почту автора.</P>
<P><FONT color=#000080>Спасибо за внимание!</FONT></P></BODY></HTML>
